<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂõæÂ§πÂ∑•ÂÖ∑ - Êñá‰ª∂ÈöêÂÜôÂÆûÁé∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background-color: #f8f0ff;
            color: #333;
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }
        
        .status-bar {
            background-color: #fff;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #eee;
        }
        
        .status-left, .status-right {
            display: flex;
            align-items: center;
        }
        
        .status-right span {
            margin-left: 10px;
        }
        
        .header {
            background: linear-gradient(135deg, #6a5af9, #d66efd);
            color: white;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(106, 90, 249, 0.3);
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px 15px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #6a5af9;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 8px;
            font-size: 18px;
        }
        
        .upload-area {
            border: 2px dashed #d66efd;
            border-radius: 8px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .upload-area:hover {
            background-color: #f9f5ff;
            border-color: #6a5af9;
        }
        
        .upload-area i {
            font-size: 40px;
            color: #d66efd;
            margin-bottom: 10px;
        }
        
        .upload-text {
            font-size: 16px;
            color: #6a5af9;
            margin-bottom: 5px;
        }
        
        .upload-hint {
            font-size: 12px;
            color: #999;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 6px;
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            background-color: #d66efd;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            margin-right: 10px;
        }
        
        .file-details {
            flex: 1;
        }
        
        .file-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .file-size {
            font-size: 12px;
            color: #999;
        }
        
        .remove-file {
            background: none;
            border: none;
            color: #ff4757;
            font-size: 18px;
            cursor: pointer;
        }
        
        .algorithm-select {
            display: flex;
            margin-bottom: 20px;
        }
        
        .algorithm-option {
            flex: 1;
            text-align: center;
            padding: 12px 5px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .algorithm-option:first-child {
            border-radius: 6px 0 0 6px;
            border-right: none;
        }
        
        .algorithm-option:last-child {
            border-radius: 0 6px 6px 0;
        }
        
        .algorithm-option.selected {
            background-color: #6a5af9;
            color: white;
            border-color: #6a5af9;
        }
        
        .algorithm-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .algorithm-desc {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .watermark-section {
            margin-bottom: 20px;
        }
        
        .watermark-label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            color: #666;
        }
        
        .watermark-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .action-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #6a5af9, #d66efd);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 90, 249, 0.4);
        }
        
        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-section {
            margin-top: 20px;
            display: none;
        }
        
        .result-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #6a5af9;
            display: flex;
            align-items: center;
        }
        
        .result-image {
            width: 100%;
            max-width: 200px;
            margin: 0 auto 15px;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .result-actions {
            display: flex;
            gap: 10px;
        }
        
        .result-btn {
            flex: 1;
            padding: 10px;
            background: #f1f1f1;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .result-btn.primary {
            background: #6a5af9;
            color: white;
        }
        
        .result-btn:hover {
            background: #e0e0e0;
        }
        
        .result-btn.primary:hover {
            background: #5a4ae9;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
        }
        
        .hidden {
            display: none;
        }
        
        .tab-container {
            display: flex;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #6a5af9, #d66efd);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .status-message {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        .status-message.success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }
        
        .status-message.error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .status-message.info {
            background-color: #d1ecf1;
            color: #0c5460;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Áä∂ÊÄÅÊ†è -->
    <div class="status-bar">
        <div class="status-left">10:57</div>
        <div class="status-right">
            <span>4G</span>
            <span>38%</span>
        </div>
    </div>
    
    <!-- Â§¥ÈÉ® -->
    <div class="header">
        <h1>ÂõæÂ§πÂ∑•ÂÖ∑ - Êñá‰ª∂ÈöêÂÜôÂÆûÁé∞</h1>
        <p>ÂÆâÂÖ®ÈöêËóèÊñá‰ª∂Âà∞ÂõæÁâá‰∏≠</p>
    </div>
    
    <!-- Ê†áÁ≠æÈ°µ -->
    <div class="container">
        <div class="tab-container">
            <div class="tab" data-tab="unpack">ÂõæÁâáËß£ÂåÖ</div>
            <div class="tab active" data-tab="pack">ÂõæÁâáÊâìÂåÖ</div>
        </div>
        
        <!-- ÂõæÁâáÊâìÂåÖÂÜÖÂÆπ -->
        <div class="tab-content active" id="pack-tab">
            <!-- Ë°®ÂõæÈÄâÊã© -->
            <div class="card">
                <div class="card-title">Ë°®ÂõæÈÄâÊã©</div>
                <div class="upload-area" id="cover-upload">
                    <i>üì∑</i>
                    <div class="upload-text">Ëá™ÂÆö‰πâ‰∏ä‰º†</div>
                    <div class="upload-hint">ÁÇπÂáªÈÄâÊã©ÂõæÁâáÊñá‰ª∂</div>
                </div>
                <div class="file-info hidden" id="cover-info">
                    <div class="file-icon">üñºÔ∏è</div>
                    <div class="file-details">
                        <div class="file-name" id="cover-name">cover.jpg</div>
                        <div class="file-size" id="cover-size">2.1 MB</div>
                    </div>
                    <button class="remove-file" id="remove-cover">√ó</button>
                </div>
            </div>
            
            <!-- ÈáåÂõæÈÄâÊã© -->
            <div class="card">
                <div class="card-title">ÈÄâÊã©ÈöêËóèÊñá‰ª∂</div>
                <div class="upload-area" id="file-upload">
                    <i>üìÅ</i>
                    <div class="upload-text">ÈÄâÊã©ÈöêËóèÊñá‰ª∂</div>
                    <div class="upload-hint">ÁÇπÂáªÈÄâÊã©Ë¶ÅÈöêËóèÁöÑÊñá‰ª∂</div>
                </div>
                <div class="file-info hidden" id="file-info">
                    <div class="file-icon">üìÑ</div>
                    <div class="file-details">
                        <div class="file-name" id="file-name">secret.txt</div>
                        <div class="file-size" id="file-size">15 KB</div>
                    </div>
                    <button class="remove-file" id="remove-file">√ó</button>
                </div>
            </div>
            
            <!-- ÁÆóÊ≥ïÈÄâÊã© -->
            <div class="card">
                <div class="card-title">ÁÆóÊ≥ïÈÄâÊã©</div>
                <div class="algorithm-select">
                    <div class="algorithm-option selected" data-algo="dynamic">
                        <div class="algorithm-name">LSBÈöêÂÜôÔºàÊ†áÂáÜÔºâ</div>
                        <div class="algorithm-desc">ÊúÄ‰ΩéÊúâÊïà‰ΩçÈöêÂÜô</div>
                    </div>
                    <div class="algorithm-option" data-algo="pro">
                        <div class="algorithm-name">LSBÈöêÂÜôÔºàÈ´òÁ∫ßÔºâ</div>
                        <div class="algorithm-desc">ÈöèÊú∫ÂÉèÁ¥†ÂàÜÂ∏É</div>
                    </div>
                </div>
                
                <!-- Ê∞¥Âç∞ËÆæÁΩÆ -->
                <div class="watermark-section">
                    <label class="watermark-label">ÂØÜÁ†Å:</label>
                    <input type="password" class="watermark-input" id="password" placeholder="ËÆæÁΩÆÂØÜÁ†Å‰øùÊä§ÔºàÂèØÈÄâÔºâ">
                </div>
            </div>
            
            <!-- Âà∂‰ΩúÂõæÂ§πÊåâÈíÆ -->
            <button class="action-btn" id="create-btn">Âà∂‰ΩúÂõæÂ§π</button>
            
            <!-- Áä∂ÊÄÅÊ∂àÊÅØ -->
            <div class="status-message" id="pack-status"></div>
            
            <!-- ÊâìÂåÖÁªìÊûú -->
            <div class="card result-section" id="result-section">
                <div class="result-title">ÊâìÂåÖÁªìÊûú</div>
                
                <div class="result-actions">
                    <button class="result-btn" id="save-btn">‰øùÂ≠òÂõæÁâá</button>
                    <button class="result-btn primary" id="share-btn">ÂàÜ‰∫´</button>
                </div>
            </div>
        </div>
        
        <!-- ÂõæÁâáËß£ÂåÖÂÜÖÂÆπ -->
        <div class="tab-content" id="unpack-tab">
            <div class="card">
                <div class="card-title">ÈÄâÊã©ÂõæÂ§πÂõæÁâá</div>
                <div class="upload-area" id="stego-upload">
                    <i>üñºÔ∏è</i>
                    <div class="upload-text">ÈÄâÊã©ÂõæÂ§πÂõæÁâá</div>
                    <div class="upload-hint">ÁÇπÂáªÈÄâÊã©ÂåÖÂê´ÈöêËóèÊñá‰ª∂ÁöÑÂõæÁâá</div>
                </div>
                <div class="file-info hidden" id="stego-info">
                    <div class="file-icon">üîç</div>
                    <div class="file-details">
                        <div class="file-name" id="stego-name">stego.png</div>
                        <div class="file-size" id="stego-size">2.3 MB</div>
                    </div>
                    <button class="remove-file" id="remove-stego">√ó</button>
                </div>
                
                <div class="watermark-section">
                    <label class="watermark-label">ÂØÜÁ†ÅÈ™åËØÅ:</label>
                    <input type="password" class="watermark-input" id="extract-password" placeholder="ËæìÂÖ•ÂØÜÁ†ÅËøõË°åÈ™åËØÅÔºàÂ¶ÇÂ∑≤ËÆæÁΩÆÔºâ">
                </div>
                
                <button class="action-btn" id="extract-btn">ÊèêÂèñÊñá‰ª∂</button>
                
                <!-- Áä∂ÊÄÅÊ∂àÊÅØ -->
                <div class="status-message" id="extract-status"></div>
                
                <div class="result-section hidden" id="extract-result">
                    <div class="result-title">ÊèêÂèñÁªìÊûú</div>
                    <div class="file-info">
                        <div class="file-icon">üìÑ</div>
                        <div class="file-details">
                            <div class="file-name" id="extracted-name">secret.txt</div>
                            <div class="file-size" id="extracted-size">15 KB</div>
                        </div>
                    </div>
                    <div class="result-actions">
                        <button class="result-btn primary" id="download-btn">‰∏ãËΩΩÊñá‰ª∂</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- È°µËÑö -->
    <div class="footer">
        <p>ÂõæÂ§πÂ∑•ÂÖ∑ v1.0 | Âü∫‰∫éLSBÈöêÂÜôÁÆóÊ≥ï</p>
    </div>

    <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ• -->
    <input type="file" id="cover-input" accept="image/*" class="hidden">
    <input type="file" id="file-input" class="hidden">
    <input type="file" id="stego-input" accept="image/*" class="hidden">

    <script>
        // DOMÂÖÉÁ¥†
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const coverUpload = document.getElementById('cover-upload');
        const fileUpload = document.getElementById('file-upload');
        const stegoUpload = document.getElementById('stego-upload');
        const coverInput = document.getElementById('cover-input');
        const fileInput = document.getElementById('file-input');
        const stegoInput = document.getElementById('stego-input');
        const coverInfo = document.getElementById('cover-info');
        const fileInfo = document.getElementById('file-info');
        const stegoInfo = document.getElementById('stego-info');
        const createBtn = document.getElementById('create-btn');
        const extractBtn = document.getElementById('extract-btn');
        const resultSection = document.getElementById('result-section');
        const extractResult = document.getElementById('extract-result');
        const algorithmOptions = document.querySelectorAll('.algorithm-option');
        const packStatus = document.getElementById('pack-status');
        const extractStatus = document.getElementById('extract-status');
        
        // ÂÖ®Â±ÄÂèòÈáè
        let selectedAlgorithm = 'dynamic';
        let coverFile = null;
        let secretFile = null;
        let stegoFile = null;
        let stegoImageCanvas = null;
        let extractedFile = null;
        
        // Ê†áÁ≠æÈ°µÂàáÊç¢
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Êõ¥Êñ∞Ê¥ªÂä®Ê†áÁ≠æ
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // ÊòæÁ§∫ÂØπÂ∫îÂÜÖÂÆπ
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // ÁÆóÊ≥ïÈÄâÊã©
        algorithmOptions.forEach(option => {
            option.addEventListener('click', () => {
                algorithmOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedAlgorithm = option.getAttribute('data-algo');
            });
        });
        
        // ‰∏ä‰º†Âå∫ÂüüÁÇπÂáª‰∫ã‰ª∂
        coverUpload.addEventListener('click', () => coverInput.click());
        fileUpload.addEventListener('click', () => fileInput.click());
        stegoUpload.addEventListener('click', () => stegoInput.click());
        
        // Êñá‰ª∂ÈÄâÊã©‰∫ã‰ª∂
        coverInput.addEventListener('change', handleCoverSelect);
        fileInput.addEventListener('change', handleFileSelect);
        stegoInput.addEventListener('change', handleStegoSelect);
        
        // ÁßªÈô§Êñá‰ª∂‰∫ã‰ª∂
        document.getElementById('remove-cover').addEventListener('click', () => {
            coverInfo.classList.add('hidden');
            coverFile = null;
            coverInput.value = '';
            resultSection.style.display = 'none';
        });
        
        document.getElementById('remove-file').addEventListener('click', () => {
            fileInfo.classList.add('hidden');
            secretFile = null;
            fileInput.value = '';
            resultSection.style.display = 'none';
        });
        
        document.getElementById('remove-stego').addEventListener('click', () => {
            stegoInfo.classList.add('hidden');
            stegoFile = null;
            stegoInput.value = '';
            extractResult.classList.add('hidden');
            extractStatus.textContent = '';
            extractStatus.className = 'status-message';
        });
        
        // Â§ÑÁêÜÂ∞ÅÈù¢ÂõæÁâáÈÄâÊã©
        function handleCoverSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showStatus(packStatus, 'ËØ∑ÈÄâÊã©ÂõæÁâáÊñá‰ª∂ÔºÅ', 'error');
                return;
            }
            
            coverFile = file;
            document.getElementById('cover-name').textContent = file.name;
            document.getElementById('cover-size').textContent = formatFileSize(file.size);
            coverInfo.classList.remove('hidden');
            resultSection.style.display = 'none';
        }
        
        // Â§ÑÁêÜÈöêËóèÊñá‰ª∂ÈÄâÊã©
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            secretFile = file;
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-size').textContent = formatFileSize(file.size);
            fileInfo.classList.remove('hidden');
            resultSection.style.display = 'none';
        }
        
        // Â§ÑÁêÜÂõæÂ§πÂõæÁâáÈÄâÊã©
        function handleStegoSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showStatus(extractStatus, 'ËØ∑ÈÄâÊã©ÂõæÁâáÊñá‰ª∂ÔºÅ', 'error');
                return;
            }
            
            stegoFile = file;
            document.getElementById('stego-name').textContent = file.name;
            document.getElementById('stego-size').textContent = formatFileSize(file.size);
            stegoInfo.classList.remove('hidden');
            extractResult.classList.add('hidden');
            extractStatus.textContent = '';
            extractStatus.className = 'status-message';
        }
        
        // Âà∂‰ΩúÂõæÂ§πÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        createBtn.addEventListener('click', async () => {
            if (!coverFile) {
                showStatus(packStatus, 'ËØ∑ÈÄâÊã©Â∞ÅÈù¢ÂõæÁâáÔºÅ', 'error');
                return;
            }
            
            if (!secretFile) {
                showStatus(packStatus, 'ËØ∑ÈÄâÊã©Ë¶ÅÈöêËóèÁöÑÊñá‰ª∂ÔºÅ', 'error');
                return;
            }
            
            // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞èÊòØÂê¶ÈÄÇÂêà
            const maxSize = await calculateMaxFileSize(coverFile);
            if (secretFile.size > maxSize) {
                showStatus(packStatus, `Êñá‰ª∂Â§™Â§ßÔºÅÊúÄÂ§ßÊîØÊåÅ ${formatFileSize(maxSize)}`, 'error');
                return;
            }
            
            // Â§ÑÁêÜËøáÁ®ã
            createBtn.textContent = 'Â§ÑÁêÜ‰∏≠...';
            createBtn.disabled = true;
            packStatus.textContent = '';
            packStatus.className = 'status-message';
            
            try {
                // ËØªÂèñÊñá‰ª∂
                const coverImage = await loadImage(coverFile);
                const fileData = await readFileAsArrayBuffer(secretFile);
                
                // Ëé∑ÂèñÂØÜÁ†Å
                const password = document.getElementById('password').value;
                
                // Âä†ÂØÜÊñá‰ª∂Êï∞ÊçÆÔºàÂ¶ÇÊûúÊèê‰æõ‰∫ÜÂØÜÁ†ÅÔºâ
                let encryptedData = fileData;
                if (password) {
                    encryptedData = await simpleEncrypt(fileData, password);
                }
                
                // Â∞ÜÊñá‰ª∂Êï∞ÊçÆÈöêËóèÂà∞ÂõæÂÉè‰∏≠
                const stegoCanvas = await embedDataInImage(coverImage, encryptedData, secretFile.name, secretFile.type);
                
                // ÊòæÁ§∫ÁªìÊûú
                const resultImage = document.getElementById('result-image');
                resultImage.src = stegoCanvas.toDataURL();
                resultSection.style.display = 'block';
                stegoImageCanvas = stegoCanvas;
                
                showStatus(packStatus, 'Êñá‰ª∂ÈöêËóèÊàêÂäüÔºÅ', 'success');
                
                // ÊªöÂä®Âà∞ÁªìÊûúÂå∫Âüü
                resultSection.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error(error);
                showStatus(packStatus, 'ÈöêËóèÊñá‰ª∂Êó∂Âá∫Èîô: ' + error.message, 'error');
            } finally {
                createBtn.textContent = 'Âà∂‰ΩúÂõæÂ§π';
                createBtn.disabled = false;
            }
        });
        
        // ÊèêÂèñÊñá‰ª∂ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        extractBtn.addEventListener('click', async () => {
            if (!stegoFile) {
                showStatus(extractStatus, 'ËØ∑ÈÄâÊã©ÂõæÂ§πÂõæÁâáÔºÅ', 'error');
                return;
            }
            
            // Â§ÑÁêÜËøáÁ®ã
            extractBtn.textContent = 'ÊèêÂèñ‰∏≠...';
            extractBtn.disabled = true;
            extractStatus.textContent = '';
            extractStatus.className = 'status-message';
            
            try {
                // Âä†ËΩΩÂõæÁâá
                const stegoImage = await loadImage(stegoFile);
                
                // ‰ªéÂõæÂÉè‰∏≠ÊèêÂèñÊï∞ÊçÆ
                const extracted = await extractDataFromImage(stegoImage);
                
                if (!extracted) {
                    showStatus(extractStatus, 'Êú™ÊâæÂà∞ÈöêËóèÊñá‰ª∂ÊàñÊñá‰ª∂Â∑≤ÊçüÂùè', 'error');
                    return;
                }
                
                // Ëé∑ÂèñÂØÜÁ†Å
                const password = document.getElementById('extract-password').value;
                
                // Ëß£ÂØÜÊï∞ÊçÆÔºàÂ¶ÇÊûúÊèê‰æõ‰∫ÜÂØÜÁ†ÅÔºâ
                let decryptedData = extracted.data;
                if (password) {
                    try {
                        decryptedData = await simpleDecrypt(decryptedData, password);
                    } catch (e) {
                        showStatus(extractStatus, 'ÂØÜÁ†ÅÈîôËØØÊàñÊñá‰ª∂ÊçüÂùè', 'error');
                        return;
                    }
                }
                
                // ÂàõÂª∫BlobÂØπË±°
                const blob = new Blob([decryptedData], { type: extracted.type });
                extractedFile = {
                    blob: blob,
                    name: extracted.name,
                    type: extracted.type
                };
                
                // ÊòæÁ§∫ÊèêÂèñÁªìÊûú
                document.getElementById('extracted-name').textContent = extracted.name;
                document.getElementById('extracted-size').textContent = formatFileSize(blob.size);
                extractResult.classList.remove('hidden');
                
                showStatus(extractStatus, `ÊàêÂäüÊèêÂèñÊñá‰ª∂: ${extracted.name}`, 'success');
                
                // ÊªöÂä®Âà∞ÁªìÊûúÂå∫Âüü
                extractResult.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error(error);
                showStatus(extractStatus, 'ÊèêÂèñÊñá‰ª∂Êó∂Âá∫Èîô: ' + error.message, 'error');
            } finally {
                extractBtn.textContent = 'ÊèêÂèñÊñá‰ª∂';
                extractBtn.disabled = false;
            }
        });
        
        // ‰øùÂ≠òÂõæÁâáÊåâÈíÆ
        document.getElementById('save-btn').addEventListener('click', () => {
            if (!stegoImageCanvas) return;
            
            const link = document.createElement('a');
            link.download = 'stego_image.png';
            link.href = stegoImageCanvas.toDataURL();
            link.click();
        });
        
        // ÂàÜ‰∫´ÊåâÈíÆ
        document.getElementById('share-btn').addEventListener('click', () => {
            alert('ÂàÜ‰∫´ÂäüËÉΩÈúÄË¶ÅÂú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÂÆûÁé∞ÔºÅ');
        });
        
        // ‰∏ãËΩΩÊñá‰ª∂ÊåâÈíÆ
        document.getElementById('download-btn').addEventListener('click', () => {
            if (!extractedFile) return;
            
            const link = document.createElement('a');
            link.download = extractedFile.name;
            link.href = URL.createObjectURL(extractedFile.blob);
            link.click();
            URL.revokeObjectURL(link.href);
        });
        
        // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
        function showStatus(element, message, type) {
            element.textContent = message;
            element.className = 'status-message ' + type;
        }
        
        // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Âä†ËΩΩÂõæÁâá
       
        // Âä†ËΩΩÂõæÁâá
        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }
        
        // ËØªÂèñÊñá‰ª∂‰∏∫ArrayBuffer
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        // ËÆ°ÁÆóÂõæÁâáÊúÄÂ§ßÂèØÈöêËóèÊñá‰ª∂Â§ßÂ∞è
        function calculateMaxFileSize(imageFile) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    // ÊØè‰∏™ÂÉèÁ¥†ÂèØ‰ª•ÈöêËóè3‰ΩçÊï∞ÊçÆÔºàRGBÂêÑ1‰ΩçÔºâ
                    const maxBits = img.width * img.height * 3;
                    // ÂáèÂéªÊñá‰ª∂Â§¥‰ø°ÊÅØÔºàÊñá‰ª∂Âêç„ÄÅÁ±ªÂûãÁ≠âÔºâ
                    const maxFileSize = Math.floor(maxBits / 8) - 100;
                    resolve(maxFileSize);
                };
                img.src = URL.createObjectURL(imageFile);
            });
        }
        
        // ÁÆÄÂçïÁöÑÂä†ÂØÜÂáΩÊï∞ÔºàXORÔºâ
        function simpleEncrypt(data, password) {
            return new Promise((resolve) => {
                const dataArray = new Uint8Array(data);
                const passwordArray = new TextEncoder().encode(password);
                const result = new Uint8Array(dataArray.length);
                
                for (let i = 0; i < dataArray.length; i++) {
                    result[i] = dataArray[i] ^ passwordArray[i % passwordArray.length];
                }
                
                resolve(result);
            });
        }
        
        // ÁÆÄÂçïÁöÑËß£ÂØÜÂáΩÊï∞ÔºàXORÔºâ
        function simpleDecrypt(data, password) {
            // XORÂä†ÂØÜÂíåËß£ÂØÜÊòØÁõ∏ÂêåÁöÑÊìç‰Ωú
            return simpleEncrypt(data, password);
        }
        
        // Â∞ÜÊï∞ÊçÆÂµåÂÖ•Âà∞ÂõæÂÉè‰∏≠ÔºàLSBÈöêÂÜôÔºâ
        function embedDataInImage(image, fileData, fileName, fileType) {
            return new Promise((resolve) => {
                // ÂàõÂª∫Canvas
                const canvas = document.createElement('canvas');
                canvas.width = image.width;
                canvas.height = image.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(image, 0, 0);
                
                // Ëé∑ÂèñÂõæÂÉèÊï∞ÊçÆ
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // Êñá‰ª∂Â§¥‰ø°ÊÅØÔºöÊñá‰ª∂ÂêçÈïøÂ∫¶(1Â≠óËäÇ) + Êñá‰ª∂Âêç + Êñá‰ª∂Á±ªÂûãÈïøÂ∫¶(1Â≠óËäÇ) + Êñá‰ª∂Á±ªÂûã + Êñá‰ª∂Êï∞ÊçÆÈïøÂ∫¶(4Â≠óËäÇ) + Êñá‰ª∂Êï∞ÊçÆ
                const fileNameBytes = new TextEncoder().encode(fileName);
                const fileTypeBytes = new TextEncoder().encode(fileType);
                
                // ËÆ°ÁÆóÊÄªÊï∞ÊçÆÈïøÂ∫¶
                const totalLength = 1 + fileNameBytes.length + 1 + fileTypeBytes.length + 4 + fileData.length;
                
                // Ê£ÄÊü•ÂõæÂÉèÂÆπÈáèÊòØÂê¶Ë∂≥Â§ü
                if (totalLength * 8 > data.length) {
                    throw new Error('ÂõæÂÉèÂÆπÈáè‰∏çË∂≥ÔºåÊó†Ê≥ïÈöêËóèËØ•Êñá‰ª∂');
                }
                
                // Â∞ÜÊñá‰ª∂Êï∞ÊçÆËΩ¨Êç¢‰∏∫‰∫åËøõÂà∂‰Ωç
                const bits = [];
                
                // Ê∑ªÂä†Êñá‰ª∂ÂêçÈïøÂ∫¶
                addByteToBits(bits, fileNameBytes.length);
                
                // Ê∑ªÂä†Êñá‰ª∂Âêç
                for (let i = 0; i < fileNameBytes.length; i++) {
                    addByteToBits(bits, fileNameBytes[i]);
                }
                
                // Ê∑ªÂä†Êñá‰ª∂Á±ªÂûãÈïøÂ∫¶
                addByteToBits(bits, fileTypeBytes.length);
                
                // Ê∑ªÂä†Êñá‰ª∂Á±ªÂûã
                for (let i = 0; i < fileTypeBytes.length; i++) {
                    addByteToBits(bits, fileTypeBytes[i]);
                }
                
                // Ê∑ªÂä†Êñá‰ª∂Êï∞ÊçÆÈïøÂ∫¶
                addIntToBits(bits, fileData.length);
                
                // Ê∑ªÂä†Êñá‰ª∂Êï∞ÊçÆ
                for (let i = 0; i < fileData.length; i++) {
                    addByteToBits(bits, fileData[i]);
                }
                
                // Â∞Ü‰∫åËøõÂà∂‰ΩçÂµåÂÖ•Âà∞ÂõæÂÉèÊï∞ÊçÆ‰∏≠
                let bitIndex = 0;
                for (let i = 0; i < data.length && bitIndex < bits.length; i++) {
                    // Ë∑≥ËøáAlphaÈÄöÈÅì
                    if ((i + 1) % 4 === 0) continue;
                    
                    // ÊõøÊç¢ÊúÄ‰ΩéÊúâÊïà‰Ωç
                    data[i] = (data[i] & 0xFE) | bits[bitIndex];
                    bitIndex++;
                }
                
                // Êõ¥Êñ∞Canvas
                ctx.putImageData(imageData, 0, 0);
                
                resolve(canvas);
            });
        }
        
        // ‰ªéÂõæÂÉè‰∏≠ÊèêÂèñÊï∞ÊçÆ
        function extractDataFromImage(image) {
            return new Promise((resolve) => {
                // ÂàõÂª∫Canvas
                const canvas = document.createElement('canvas');
                canvas.width = image.width;
                canvas.height = image.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(image, 0, 0);
                
                // Ëé∑ÂèñÂõæÂÉèÊï∞ÊçÆ
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // ÊèêÂèñ‰∫åËøõÂà∂‰Ωç
                const bits = [];
                for (let i = 0; i < data.length; i++) {
                    // Ë∑≥ËøáAlphaÈÄöÈÅì
                    if ((i + 1) % 4 === 0) continue;
                    
                    // ÊèêÂèñÊúÄ‰ΩéÊúâÊïà‰Ωç
                    bits.push(data[i] & 1);
                }
                
                let bitIndex = 0;
                
                // ÊèêÂèñÊñá‰ª∂ÂêçÈïøÂ∫¶
                const fileNameLength = extractByteFromBits(bits, bitIndex);
                bitIndex += 8;
                
                // ÊèêÂèñÊñá‰ª∂Âêç
                const fileNameBytes = new Uint8Array(fileNameLength);
                for (let i = 0; i < fileNameLength; i++) {
                    fileNameBytes[i] = extractByteFromBits(bits, bitIndex);
                    bitIndex += 8;
                }
                const fileName = new TextDecoder().decode(fileNameBytes);
                
                // ÊèêÂèñÊñá‰ª∂Á±ªÂûãÈïøÂ∫¶
                const fileTypeLength = extractByteFromBits(bits, bitIndex);
                bitIndex += 8;
                
                // ÊèêÂèñÊñá‰ª∂Á±ªÂûã
                const fileTypeBytes = new Uint8Array(fileTypeLength);
                for (let i = 0; i < fileTypeLength; i++) {
                    fileTypeBytes[i] = extractByteFromBits(bits, bitIndex);
                    bitIndex += 8;
                }
                const fileType = new TextDecoder().decode(fileTypeBytes);
                
                // ÊèêÂèñÊñá‰ª∂Êï∞ÊçÆÈïøÂ∫¶
                const fileSize = extractIntFromBits(bits, bitIndex);
                bitIndex += 32;
                
                // ÊèêÂèñÊñá‰ª∂Êï∞ÊçÆ
                const fileData = new Uint8Array(fileSize);
                for (let i = 0; i < fileSize; i++) {
                    fileData[i] = extractByteFromBits(bits, bitIndex);
                    bitIndex += 8;
                }
                
                resolve({
                    name: fileName,
                    type: fileType,
                    data: fileData
                });
            });
        }
        
        // ËæÖÂä©ÂáΩÊï∞ÔºöÂ∞ÜÂ≠óËäÇÊ∑ªÂä†Âà∞‰∫åËøõÂà∂‰ΩçÊï∞ÁªÑ
        function addByteToBits(bits, byte) {
            for (let i = 7; i >= 0; i--) {
                bits.push((byte >> i) & 1);
            }
        }
        
        // ËæÖÂä©ÂáΩÊï∞ÔºöÂ∞ÜÊï¥Êï∞Ê∑ªÂä†Âà∞‰∫åËøõÂà∂‰ΩçÊï∞ÁªÑ
        function addIntToBits(bits, int) {
            for (let i = 24; i >= 0; i -= 8) {
                addByteToBits(bits, (int >> i) & 0xFF);
            }
        }
        
        // ËæÖÂä©ÂáΩÊï∞Ôºö‰ªé‰∫åËøõÂà∂‰ΩçÊï∞ÁªÑ‰∏≠ÊèêÂèñÂ≠óËäÇ
        function extractByteFromBits(bits, startIndex) {
            let byte = 0;
            for (let i = 0; i < 8; i++) {
                byte = (byte << 1) | bits[startIndex + i];
            }
            return byte;
        }
        
        // ËæÖÂä©ÂáΩÊï∞Ôºö‰ªé‰∫åËøõÂà∂‰ΩçÊï∞ÁªÑ‰∏≠ÊèêÂèñÊï¥Êï∞
        function extractIntFromBits(bits, startIndex) {
            let int = 0;
            for (let i = 0; i < 4; i++) {
                int = (int << 8) | extractByteFromBits(bits, startIndex + i * 8);
            }
            return int;
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            // Ê∑ªÂä†ÁªìÊûúÂõæÁâáÈ¢ÑËßà
            const resultSection = document.getElementById('result-section');
            const resultImage = document.createElement('img');
            resultImage.id = 'result-image';
            resultImage.className = 'result-image';
            resultSection.insertBefore(resultImage, resultSection.querySelector('.result-actions'));
        });
    </script>
</body>
</html>
