<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
<title>图片混淆</title>
<style>
/* 新增：背景样式 */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow-x: hidden;
}

#background-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background: linear-gradient(125deg, #0f0c29, #302b63, #24243e);
}

/* 原有样式调整 */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: transparent;
  color: #333;
}

.container {
  position: relative;
  z-index: 1;
  background: rgba(255, 255, 255, 0.85);
  margin: 20px auto;
  max-width: 800px;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  padding: 20px;
  backdrop-filter: blur(5px);
}

input{
  background:#fff;
  border:1px solid #aaa;
  height:1.5rem;
  border-radius: 4px;
  padding: 0 8px;
}
button{
  background:#fff;
  border:1px solid #888;
  height:1.8rem;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  padding: 0 12px;
}
button:hover {
  background: #f0f0f0;
  transform: translateY(-1px);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
select{
  background:#fff;
  border:1px solid #aaa;
  height:1.6rem;
  border-radius: 4px;
  padding: 0 8px;
}

h1 {
  color: #2c3e50;
  margin-bottom: 20px;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
}

#imgwrap {
  margin: 20px 0;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

#mzsm {
  border-top: 1px solid #eee;
  padding-top: 15px;
  margin-top: 20px;
}
</style>
</head>
<body>
<!-- 新增：背景画布 -->
<canvas id="background-canvas"></canvas>

<div class="container">
  <h1>Ybzj图片混淆</h1>

  <input style="border:0px;display:none" onchange="ipt()" type="file" id="ipt" accept="image/*">
  <button onclick="xuanze()">选择图片</button>&emsp;<button onclick="baocun()">保存图片</button>
  <br />
  <br />
  <span>模式：</span>
  <select id="slct" onchange="selectonchange()">
    <option value="b">方块混淆</option>
    <option value="c2">行像素混淆</option>
    <option value="c">像素混淆</option>
    <option value="pe1">兼容PicEncrypt: 行模式</option>
    <option value="pe2">兼容PicEncrypt: 行+列模式</option>
  </select>
  <br />
  <span>密钥：</span>
  <input type="text" id="ikey" placeholder="可为任意字符串">
  <input style="display:none" type="number" id="ikey2" value="0.666" placeholder="大于0小于1的任意小数">
  <br />
  <br />
  <button onclick="jiami()">&ensp;混淆&ensp;</button>&emsp;<button onclick="jiemi()">解混淆</button>&emsp;<button onclick="huanyuan()">&ensp;还原&ensp;</button>

  <div id="imgwrap">
    <div id="picinfo" style="font-size:1rem;color:#666;padding:0.5rem 0"></div>
    
  </div>
  <div id="loading" style="display:none;color:#666;padding:0.5rem 0">
    正在生成中...
  </div>
  <div id="mzsm" style="font-weight:bold;color:#ff5d00;padding:0 0 1rem 0">
    <div style="font-size:1.5rem">
      免责声明
    </div>
    本页面仅供技术研究使用，<br />
    请勿用于非法用途，<br />
    否则后果作者概不负责！
  </div>

  <div style="color:#666;padding:1rem 0 2rem 0">
    <span>v0.2.1 by ybzjdsd 原网址https://ybzjdsd.gitee.io/tphx</span>
  </div>
</div>

<script>
// 新增：粒子背景效果
(function() {
  const canvas = document.getElementById('background-canvas');
  const ctx = canvas.getContext('2d');
  
  // 设置画布尺寸
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  
  // 初始化
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  
  // 粒子类
  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 2 + 0.5;
      this.speedX = Math.random() * 1 - 0.5;
      this.speedY = Math.random() * 1 - 0.5;
      this.color = `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.1})`;
    }
    
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      
      // 边界检查
      if (this.x > canvas.width) this.x = 0;
      else if (this.x < 0) this.x = canvas.width;
      if (this.y > canvas.height) this.y = 0;
      else if (this.y < 0) this.y = canvas.height;
    }
    
    draw() {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }
  
  // 创建粒子
  const particles = [];
  const particleCount = Math.min(100, Math.floor((canvas.width * canvas.height) / 15000));
  
  for (let i = 0; i < particleCount; i++) {
    particles.push(new Particle());
  }
  
  // 连线函数
  function connectParticles() {
    for (let a = 0; a < particles.length; a++) {
      for (let b = a; b < particles.length; b++) {
        const dx = particles[a].x - particles[b].x;
        const dy = particles[a].y - particles[b].y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance < 100) {
          const opacity = 1 - distance / 100;
          ctx.strokeStyle = `rgba(200, 200, 255, ${opacity * 0.2})`;
          ctx.lineWidth = 0.5;
          ctx.beginPath();
          ctx.moveTo(particles[a].x, particles[a].y);
          ctx.lineTo(particles[b].x, particles[b].y);
          ctx.stroke();
        }
      }
    }
  }
  
  // 动画循环
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 更新和绘制粒子
    for (let i = 0; i < particles.length; i++) {
      particles[i].update();
      particles[i].draw();
    }
    
    // 绘制连线
    connectParticles();
    
    requestAnimationFrame(animate);
  }
  
  animate();
})();

// 原有JavaScript代码保持不变
var md5=(function(){
// ... 原有的md5函数代码保持不变
})();

let IMG=new Image();
let SIZE=4294967296;
let MZSMshow=true;
let SRC="";
let OPICSRC="";
let INFO1="请先上传图片！";
let INFO2="本页面仅供技术研究使用，请勿用于非法用途，否则后果作者概不负责";
let INFO3="ybzjdsd.gitee.io/tphx\nybzjdsd.github.io/tphx";

function selectonchange(){
  if(["pe1","pe2"].indexOf(document.getElementById("slct").value)==-1){
    document.getElementById("ikey2").style.display="none";
    document.getElementById("ikey").style.display="inline";
  }else{
    document.getElementById("ikey").style.display="none";
    document.getElementById("ikey2").style.display="inline";
  }
}

function xuanze(){
  if(MZSMshow){
    document.getElementById("mzsm").style.display="none";
    MZSMshow=false
  }
  document.getElementById("ipt").click();
}

function huanyuan(){
  if(SRC==""){alert(INFO1)}else{
    setpic(OPICSRC);
    document.getElementById("picinfo").innerHTML="&emsp;"
  }
}

function baocun(){
  if(SRC==""){alert(INFO1)}else{
    let alink=document.createElement("a");
    alink.download="pic_"+(parseInt(Date.now()/1000)%Math.pow(36,6) +Math.pow(36,6)).toString(36).slice(1) +".png";
    alink.href=SRC;
    alink.click();
  }
}

function setpic(dturl){
  if(SRC){
    URL.revokeObjectURL(SRC)
  }
  SRC=URL.createObjectURL(dataURLtoBlob(dturl));
  IMG.src=SRC
  document.getElementById("kimg").src=SRC;
}

function dataURLtoBlob(dataurl) {
  var arr = dataurl.split(',');
  var _arr = arr[1].substring(0,arr[1].length-2);
  var mime = arr[0].match(/:(.*?);/)[1],
    bstr =atob(_arr),
    n = bstr.length,
    u8arr = new Uint8Array(n);
  while (n--) {
    u8arr[n] = bstr.charCodeAt(n);
  }
  return new Blob([u8arr], {
    type: mime
  });
}

function ipt(){
  var oFReader = new FileReader();
  var ofile = document.getElementById("ipt").files[0];
  oFReader.readAsDataURL(ofile);
  oFReader.onloadend = function(oFRevent){
    var osrc = oFRevent.target.result;
    OPICSRC=osrc;
    setpic(osrc);
    document.getElementById("picinfo").innerHTML="&emsp;"
  }
}

function jiami(){
  if(SRC==""){alert(INFO1)}else{
    let t=Date.now();
    let s="";
    let a=document.getElementById("slct").value;
    let k=document.getElementById("ikey").value;
    let k2=parseFloat(document.getElementById("ikey2").value);

    document.getElementById("imgwrap").style.display="none";
    document.getElementById("loading").style.display="block";

    requestAnimationFrame(function(){
      requestAnimationFrame(function(){
        if(a=="b"){
          s=encryptB2(IMG,k,32,32);
        }else if(a=="c"){
          s=encryptC(IMG,k);
        }else if(a=="pe1"){
          s=encryptPE1(IMG,k2);
        }else if(a=="pe2"){
          s=encryptPE2(IMG,k2);
        }else{
          s=encryptC2(IMG,k);
        }
        setpic(s[0]);
        document.getElementById("picinfo").innerHTML="size:&ensp;"+s[1]+"×"+s[2]+"&emsp;time:&ensp;"+(Date.now()-t).toString()+"ms"
        document.getElementById("imgwrap").style.display="block";
        document.getElementById("loading").style.display="none";
      })
    })
  }
}

function jiemi(){
  if(SRC==""){alert(INFO1)}else{
    let t=Date.now();
    let s="";
    let a=document.getElementById("slct").value;
    let k=document.getElementById("ikey").value;
    let k2=parseFloat(document.getElementById("ikey2").value);

    document.getElementById("imgwrap").style.display="none";
    document.getElementById("loading").style.display="block";

    requestAnimationFrame(function(){
      requestAnimationFrame(function(){
        if(a=="b"){
          s=decryptB2(IMG,k,32,32);
        }else if(a=="c"){
          s=decryptC(IMG,k);
        }else if(a=="pe1"){
          s=decryptPE1(IMG,k2);
        }else if(a=="pe2"){
          s=decryptPE2(IMG,k2);
        }else{
          s=decryptC2(IMG,k);
        }
        setpic(s[0]);
        document.getElementById("kimg").src=SRC;
        document.getElementById("picinfo").innerHTML="size:&ensp;"+s[1]+"×"+s[2]+"&emsp;time:&ensp;"+(Date.now()-t).toString()+"ms"
        document.getElementById("imgwrap").style.display="block";
        document.getElementById("loading").style.display="none";
      })
    })
  }
}

// 原有的加密/解密函数保持不变
// ... (包括amess, encryptB2, decryptB2, encryptC, decryptC等函数)
</script>
</body>
</html>